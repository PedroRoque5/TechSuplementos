<?php
require_once './TechSuplementos/DAO/Conexao.php';

if ($_SERVER['REQUEST_METHOD'] == 'POST') {
    $email = filter_input(INPUT_POST, 'email', FILTER_VALIDATE_EMAIL);
    $nome = filter_input(INPUT_POST, 'nome', FILTER_SANITIZE_STRING);
    $cnpj = filter_input(INPUT_POST, 'cnpj', FILTER_SANITIZE_STRING);
    $telefone = filter_input(INPUT_POST, 'telefone', FILTER_SANITIZE_STRING);
    $pais = filter_input(INPUT_POST, 'pais', FILTER_SANITIZE_STRING);
    $data = filter_input(INPUT_POST, 'data', FILTER_SANITIZE_STRING);
    $senha = filter_input(INPUT_POST, 'senha', FILTER_SANITIZE_STRING);

    if ($email && $nome && $cnpj && $telefone && $pais && $data && $senha) {
        $senhaHash = password_hash($senha, PASSWORD_DEFAULT);
        $conexao = new Conexao();

        $query = "INSERT INTO empresa (email, nome, cnpj, telefone, pais_origem, data_criacao, senha)
                  VALUES (:email, :nome, :cnpj, :telefone, :pais, :data, :senha)";
        $params = [
            ':email' => $email,
            ':nome' => $nome,
            ':cnpj' => $cnpj,
            ':telefone' => $telefone,
            ':pais' => $pais,
            ':data' => $data,
            ':senha' => $senhaHash
        ];

        try {
            $empresaId = $conexao->inserir($query, $params);
            echo "Empresa cadastrada com sucesso! ID: " . $empresaId;
        } catch (Exception $e) {
            echo "Erro ao cadastrar empresa: " . $e->getMessage();
        }
    } else {
        echo "Preencha todos os campos corretamente.";
    }
}
?>
